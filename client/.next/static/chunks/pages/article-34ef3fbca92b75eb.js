(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[309],{1656:function(e,t,r){"use strict";var n=r(29),a=r(7794),i=r.n(a),c=r(7294),l=r(3964),s=r(5954),o=r(6993),u=r(1739),_=r.n(u),m=r(4184),d=r.n(m),p=r(6741),f=r(5893);t.Z=function(e){var t,r=e.article,a=(r.title,r.tags),u=(r.content,r.category),m=r.createTime,h=r.likeNum,x=(r.cover,r.comments,r._id),v=(0,l.NW)(),y=(0,s.Z)(),j=y.user,N=y.setUser,k=null===j||void 0===j||null===(t=j.articleIds)||void 0===t?void 0:t.includes(x),C=(0,c.useCallback)((0,n.Z)(i().mark((function e(){var t,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(j){e.next=2;break}return e.abrupt("return",l.v0.error("\u52a8\u52a8\u624b\u6307\u767b\u5f55\u4e0b\u5427~"));case 2:if(t=j.articleIds,-1!==(n=t.indexOf(x))){e.next=12;break}return t.push(x),e.next=8,(0,p.Nq)(j._id,{articleIds:t});case 8:r.likeNum++,l.v0.success("\u6536\u85cf\u6210\u529f"),e.next=17;break;case 12:return t.splice(n,1),e.next=15,(0,p.Nq)(j._id,{articleIds:t});case 15:r.likeNum--,l.v0.success("\u5df2\u53d6\u6d88\u6536\u85cf");case 17:v(),N(j);case 19:case"end":return e.stop()}}),e)}))),[j,x]);return(0,f.jsxs)("ul",{className:_().detail,children:[(0,f.jsxs)("li",{className:_().categoryBox,children:[(0,f.jsx)(o.Z,{type:"icon-category"})," ",(0,f.jsx)("span",{className:_().category,children:u})]}),(0,f.jsxs)("li",{className:_().tagBox,children:[(0,f.jsx)(o.Z,{type:"icon-tags"}),a&&a.length>0&&a.map((function(e){return(0,f.jsx)("span",{className:_().tag,children:e},e)}))]}),(0,f.jsxs)("li",{className:_().dateBox,children:[(0,f.jsx)(o.Z,{type:"icon-ico-date"}),(0,f.jsx)("span",{className:_().date,children:(0,l.m8)(m)})]}),(0,f.jsxs)("li",{children:[(0,f.jsx)(o.Z,{onClick:C,className:d()(_().like,{"color-red":k}),type:"icon-like"}),(0,f.jsx)("span",{className:_().likeNum,children:h})]})]})}},485:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return B}});var n=r(29),a=r(7794),i=r.n(a),c=r(1163),l=r(7294),s=r(3964),o=r(6741),u=r(9499),_=r(4730),m=r(5954),d=r(6993),p=r(9743),f=r.n(p),h=r(5893),x=["articleComment","fatherComment","onReply"];function v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach((function(t){(0,u.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var j=function e(t){var r=t.articleComment,a=t.fatherComment,c=t.onReply,o=(0,_.Z)(t,x),u=r.username,p=r.children,v=r.content,j=r.createTime,N=r.forUsername,k=r._id,C=(r.articleId,(0,m.Z)().user),b=(0,l.useState)(!1),g=b[0],D=b[1],A=(0,l.useRef)(),O=(0,l.useCallback)((function(){if(!C)return s.v0.error("\u52a8\u52a8\u624b\u6307\u767b\u5f55\u4e0b\u5427~");g||(D(!0),setTimeout((function(){document.body.addEventListener("click",(function e(t){for(var r=t.target;r&&r!==A.current;)r=r.parentNode;r||(D(!1),document.body.removeEventListener("click",e))}))})))}),[C,g]),w=(0,l.useCallback)(function(){var e=(0,n.Z)(i().mark((function e(t,n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c(k,n,a||r);case 2:D(!1);case 3:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),[c]);return(0,h.jsxs)("div",y(y({id:k,className:f().container},o),{},{children:[(0,h.jsxs)("div",{className:f().body,children:[(0,h.jsx)("div",{className:f().left,children:(0,h.jsx)(d.Z,{className:f().avatar,type:"icon-user-avatar-full-fill"})}),(0,h.jsxs)("div",{className:f().right,children:[(0,h.jsxs)("div",{className:f().username,children:[u||"\u7a7a\u7a7a\u7a7a\u7a7a\u7a7a\u7a7a"," ","string"===typeof N?(0,h.jsx)("span",{className:f().usernameAddition,children:"\u56de\u590d\u4e86 ".concat(N||"\u7a7a\u7a7a\u7a7a\u7a7a\u7a7a\u7a7a")}):null]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("span",{className:f().time,children:(0,s.m8)(j)}),(0,h.jsx)("span",{className:f().reply,onClick:O,children:"\u56de\u590d"})]}),(0,h.jsx)("div",{className:f().content,children:v||"\u7a7a\u7a7a\u7a7a\u7a7a\u7a7a\u7a7a"}),g?(0,h.jsx)("div",{ref:A,className:f().replyBox,children:(0,h.jsx)(s.l6,{onButtonClick:w,placeholder:"\u8bf7\u8f93\u5165\u8bc4\u8bba\u5185\u5bb9",buttonPos:"right",children:"\u786e\u5b9a"})}):null]})]}),p&&p.length>0?(0,h.jsx)("div",{className:f().children,children:p.map((function(t){return(0,h.jsx)(e,{fatherComment:r,onReply:c,style:{backgroundColor:"rgba(193,193,193,0.1)",borderBottom:"none"},articleComment:t},t._id)}))}):null]}))},N=r(4179),k=r.n(N),C=r(1656),b=r(4184),g=r.n(b),D=r(993),A=r.n(D),O=function(e){var t=e.onClick,r=e.className,n=(0,c.useRouter)(),a=(0,l.useCallback)((function(e){n.back(),t&&t(e)}),[t]),i={};return r&&(i[r]=!0),(0,h.jsx)("div",{className:g()(i,A().back),onClick:a,children:"\xd7"})},w=r(5694),B=(r(3774),r(9936),function(e){var t=(0,c.useRouter)(),r=(0,s.o7)((function(e){return(0,s.Vr)(e)})),a=r.data,u=r.loading,_=r.run,d=(0,m.Z)(),p=d.user,f=(d.setUser,(0,s.NW)());(0,l.useEffect)((function(){t.query.id&&_(t.query.id)}),[t.query.id]);var x=a.title,v=a.content,y=a.cover,N=a.comments,b=(a._id,t.asPath.split("#")[1]);(0,l.useEffect)((function(){b&&!u&&t.push(t.asPath)}),[b,u]);var g=function(){var e=(0,n.Z)(i().mark((function e(r,n,a){var c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p){e.next=2;break}return e.abrupt("return",s.v0.error("\u52a8\u52a8\u624b\u6307\u767b\u5f55\u4e0b\u5427~"));case 2:if(!((n=n.trim()).length>200)){e.next=5;break}return e.abrupt("return",s.v0.error("\u8bc4\u8bba\u5185\u5bb9\u6700\u591a200\u4e2a\u5b57"));case 5:if(0!=n.length){e.next=7;break}return e.abrupt("return",s.v0.error("\u60a8\u8fd8\u6ca1\u6709\u8f93\u5165\u5185\u5bb9"));case 7:return e.next=9,(0,o.Yr)({content:n,targetCommentId:r,auditStatus:1,articleId:t.query.id,userId:p._id});case 9:(c=e.sent).username=p.username,a?(c.forUsername=a.username,(a.children||(a.children=[])).push(c)):N.push(c),f(),s.v0.success("\u56de\u590d\u6210\u529f");case 14:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}();return(0,h.jsx)(w.Z,{loading:u,children:(0,h.jsxs)("div",{className:k().container,children:[(0,h.jsxs)("div",{className:k().articleContainer,children:[(0,h.jsx)(O,{className:k().back}),(0,h.jsx)("h1",{className:k().title,children:x}),(0,h.jsx)(C.Z,{article:a}),y&&y.url?(0,h.jsx)(s.Ei,{className:k().cover,src:y.url}):null,(0,h.jsx)("article",{children:(0,h.jsx)(s.Rn,{markdown:v})}),(0,h.jsx)("div",{className:k().operation,children:(0,h.jsx)("span",{className:k()["operation-like"]})})]}),(0,h.jsxs)("div",{className:k().commentContainer,children:[(0,h.jsx)("h3",{className:k().commentTitle,children:"\u8bc4\u8bba"}),(0,h.jsx)("div",{children:N&&N.length>0?N.map((function(e){return(0,h.jsx)(j,{onReply:g,articleComment:e},e._id)})):(0,h.jsx)("div",{className:k().empty,children:"\u6682\u65e0\u8bc4\u8bba"})})]}),(0,h.jsx)("div",{className:k().replyContainer,children:(0,h.jsx)(s.l6,{onButtonClick:function(e,t){return g(null,t)},placeholder:"\u8bf4\u70b9\u4ec0\u4e48...",buttonPos:"right",autoClear:!0,children:"\u8bc4\u8bba"})})]})})})},4796:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/article",function(){return r(485)}])},1739:function(e){e.exports={categoryBox:"ArticleDetail_categoryBox__hUFBN",tagBox:"ArticleDetail_tagBox__f_bWj",detail:"ArticleDetail_detail__WAXvj",dateBox:"ArticleDetail_dateBox__ay2Es",container:"ArticleDetail_container__nas4z",articleContainer:"ArticleDetail_articleContainer__sBEDL",title:"ArticleDetail_title__mhedz",cover:"ArticleDetail_cover__GACPc",tag:"ArticleDetail_tag__0_BSF",category:"ArticleDetail_category__X2XYA",likeNum:"ArticleDetail_likeNum__UsOBM",date:"ArticleDetail_date__ykFJg",commentContainer:"ArticleDetail_commentContainer__3l1rF",commentTitle:"ArticleDetail_commentTitle__vYePf",replyContainer:"ArticleDetail_replyContainer__l7Ymo",empty:"ArticleDetail_empty__wA9Nr",like:"ArticleDetail_like__9_pD2"}},993:function(e){e.exports={back:"Back_back__uiQV5"}},9743:function(e){e.exports={container:"Comment_container__z8V_F",body:"Comment_body__fMDF0",avatar:"Comment_avatar__F9xcc",right:"Comment_right__3hcJD",username:"Comment_username__Q0Ipg",usernameAddition:"Comment_usernameAddition__51QW_",time:"Comment_time__YK5rH",reply:"Comment_reply__x29gX",content:"Comment_content__R01VM",replyBox:"Comment_replyBox__VOKKp",children:"Comment_children__L6xVS"}},4179:function(e){e.exports={container:"article_container__KUvPp",articleContainer:"article_articleContainer__afZ1e",back:"article_back__1wJNE",title:"article_title__30KGS",cover:"article_cover__jHvFk",tag:"article_tag__Cc7V5",category:"article_category__1b8cK",likeNum:"article_likeNum__g9FaB",date:"article_date__f_u2y",commentContainer:"article_commentContainer__WQlny",commentTitle:"article_commentTitle__Ga2Ea",replyContainer:"article_replyContainer___6ljN",empty:"article_empty__Q_TvJ",like:"article_like__a1KhZ"}},3774:function(){},9936:function(){}},function(e){e.O(0,[774,888,179],(function(){return t=4796,e(e.s=t);var t}));var t=e.O();_N_E=t}]);